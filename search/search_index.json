{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/","title":"Installation CASTEP - AOCL","text":""},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#castep-2512-aocl-ubuntu-2404-ryzen-3900x-guia-final","title":"CASTEP 25.12 + AOCL (Ubuntu 24.04, Ryzen 3900X) \u2014 Guia Final","text":""},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#0-pre-requisitos","title":"0) Pr\u00e9-requisitos","text":"<p><pre><code>sudo apt update\nsudo apt install -y build-essential gfortran cmake git \\\n    libopenmpi-dev openmpi-bin \\\n    libfftw3-dev python3 python3-pip gawk\n</code></pre> Confirme MPI <pre><code>which mpif90\nwhich mpirun\n# Esperado:\n# /usr/bin/mpif90\n# /usr/bin/mpirun\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#1-definir-aocl-e-diretorios-de-biblioteca","title":"1) Definir AOCL e diret\u00f3rios de biblioteca","text":"<p>Voc\u00ea instalou o AOCL em: /opt/AMD/aocl/aocl-linux-gcc-5.1.0</p> <p>Defina vari\u00e1veis e caminho das libs (LP64):</p> <pre><code>export AOCL=/opt/AMD/aocl/aocl-linux-gcc-5.1.0\nexport LIBDIR=$AOCL/gcc/lib_LP64\nexport LD_LIBRARY_PATH=$LIBDIR:$LD_LIBRARY_PATH\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#2-ajustar-symlinks-das-libs-aocl-uma-vez-so","title":"2) Ajustar symlinks das libs AOCL (uma vez s\u00f3)","text":"<p>O CASTEP procura libblis.so e libflame.so. No AOCL encontramos:</p> <p><pre><code>/opt/AMD/aocl/aocl-linux-gcc-5.1.0/gcc/lib_LP64/libblis.so.5.1.0\n/opt/AMD/aocl/aocl-linux-gcc-5.1.0/gcc/lib_LP64/libflame.so\n</code></pre> Crie os symlinks (no mesmo diret\u00f3rio): <pre><code>cd /opt/AMD/aocl/aocl-linux-gcc-5.1.0/gcc/lib_LP64\nsudo ln -s libblis.so.5.1.0 libblis.so\nsudo ln -s libblis-mt.so.5.1.0 libblis-mt.so\n# libflame.so j\u00e1 tem o nome esperado\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#3-descompactar-o-castep","title":"3) Descompactar o CASTEP","text":"<pre><code>tar -zxf CASTEP-25.12.tar.gz\ncd CASTEP-25.12\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#4-compilar-serial-e-mpi-com-aocl-fftw3","title":"4) Compilar (serial e MPI) com AOCL + FFTW3","text":"<p>4.1 Serial (opcional, \u00fatil para utilit\u00e1rios)</p> <p><pre><code>make clean\nmake -j$(nproc) COMMS_ARCH=serial \\\n     MATHLIBS=aocl MATHLIBDIR=\"$LIBDIR\" \\\n     FFT=fftw3  FFTLIBDIR=\"$LIBDIR\" \\\n     BUILD=fast TARGETCPU=host\nmake COMMS_ARCH=serial install\n</code></pre> Instala em: <pre><code>bin/linux_x86_64_gfortran10--serial/\n</code></pre> 4.2 MPI (principal) <pre><code>make clean\nmake -j$(nproc) COMMS_ARCH=mpi \\\n     MATHLIBS=aocl MATHLIBDIR=\"$LIBDIR\" \\\n     FFT=fftw3  FFTLIBDIR=\"$LIBDIR\" \\\n     BUILD=fast TARGETCPU=host\nmake COMMS_ARCH=mpi install\n</code></pre></p> <p>Instala em: <pre><code>bin/linux_x86_64_gfortran10--mpi/\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#5-verificar-linkedicao-com-aocl","title":"5) Verificar linkedi\u00e7\u00e3o com AOCL","text":"<pre><code>ldd obj/linux_x86_64_gfortran*/castep.mpi | grep -E \"blis|flame\"\n# Esperado (caminhos AOCL):\n# libflame.so =&gt; /opt/AMD/aocl/aocl-linux-gcc-5.1.0/gcc/lib_LP64/libflame.so\n# libblis.so.5 =&gt; /opt/AMD/aocl/aocl-linux-gcc-5.1.0/gcc/lib_LP64/libblis.so.5\n# libblis-mt.so.5 =&gt; /opt/AMD/aocl/aocl-linux-gcc-5.1.0/gcc/lib_LP64/libblis-mt.so.5\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#6-teste-rapido-mpi","title":"6) Teste r\u00e1pido (MPI)","text":"<p>Com arquivos si.cell/si.param prontos, rode: <pre><code>mpirun -np 4 ~/CASTEP/CASTEP-25.12/bin/linux_x86_64_gfortran10--mpi/castep.mpi si\n</code></pre></p> <p>(Ajuste -np conforme desejar.)</p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#7-persistir-ambiente-no-bashrc","title":"7) Persistir ambiente no ~/.bashrc","text":"<p>Abra o arquivo:</p> <p><pre><code>nano ~/.bashrc\n</code></pre> Adicione ao final (usando os mesmos nomes de vari\u00e1veis/comandos que usamos acima): <pre><code># === AOCL libraries ===\nexport AOCL=/opt/AMD/aocl/aocl-linux-gcc-5.1.0\nexport LD_LIBRARY_PATH=$AOCL/gcc/lib_LP64:$LD_LIBRARY_PATH\n\n# === CASTEP binaries (MPI) ===\nexport PATH=$HOME/CASTEP/CASTEP-25.12/bin/linux_x86_64_gfortran10--mpi:$PATH\n</code></pre> Salve e recarregue: <pre><code>source ~/.bashrc\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#8-wrapper-para-simplificar-mpirun-np-castepmpi","title":"8) Wrapper para simplificar mpirun -np ... castep.mpi","text":"<p>Crie /usr/local/bin/castep-mpi:</p> <pre><code>sudo bash -lc 'cat &gt; /usr/local/bin/castep-mpi &lt;&lt; \"EOF\"\n#!/bin/bash\n# Uso: castep-mpi &lt;nprocs&gt; &lt;seed&gt; [args...]\nNPROCS=\"$1\"\nSEED=\"$2\"\nshift 2\nmpirun -np \"$NPROCS\" $HOME/CASTEP/CASTEP-25.12/bin/linux_x86_64_gfortran10--mpi/castep.mpi \"$SEED\" \"$@\"\nEOF\nchmod +x /usr/local/bin/castep-mpi'\n</code></pre> <p>Agora voc\u00ea pode rodar assim: <pre><code>castep-mpi 4 si\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#9-duvidas-comuns-troubleshooting","title":"9) D\u00favidas comuns / Troubleshooting","text":"<p>MPI_ABORT ... errorcode 1 logo no in\u00edcio Quase sempre \u00e9 falta de pseudopotencial. Use OTFG no .cell: <pre><code>%BLOCK SPECIES_POT\nSi  OTFG  [Si] 3|2.0|2.0|2.0:2|6.0|8.0|10.0\n%ENDBLOCK SPECIES_POT\n</code></pre> ou defina PSPOT_DIR para .usp.</p> <p>cannot find -lflame / -lblis Garanta:</p> <pre><code>export LIBDIR=$AOCL/gcc/lib_LP64\n\nexport LD_LIBRARY_PATH=$LIBDIR:$LD_LIBRARY_PATH\n</code></pre> <p>symlinks criados (passo 2).</p> <p>Utilit\u00e1rios reclamando diret\u00f3rio --serial ausente no make install \u00c9 normal se voc\u00ea instalou s\u00f3 MPI. Para instalar utilit\u00e1rios, tamb\u00e9m rode o build/instala\u00e7\u00e3o serial:</p> <p><pre><code>make COMMS_ARCH=serial BUILD=fast TARGETCPU=host\nmake COMMS_ARCH=serial install\n</code></pre> Quantos processos usar? Sua CPU tem 12 cores f\u00edsicos / 24 threads. Comece testando:</p> <p>castep-mpi 12 si (1 MPI por core f\u00edsico)</p> <p>compare com castep-mpi 24 si (1 MPI por thread)</p> <p>e com castep-mpi 4 si (teste leve)</p>"},{"location":"DFT/Installation%20CASTEP%20-%20AOCL/#10-exemplo-final-de-execucao","title":"10) Exemplo final de execu\u00e7\u00e3o","text":"<pre><code># com wrapper e 12 processos (recomenda\u00e7\u00e3o inicial)\ncastep-mpi 12 si\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/","title":"Installation CASTEP - MKL","text":""},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#castep-2512-intel-mkl-openmpi-on-ubuntu-2404","title":"CASTEP 25.12 + Intel MKL + OpenMPI on Ubuntu 24.04","text":"<p>This guide explains how to install and run CASTEP 25.12 with Intel MKL and OpenMPI on Ubuntu 24.04.</p>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#system-information","title":"System Information","text":"<ul> <li>CPU: <code>Intel Core i9</code> (24 cores / 32 threads)</li> <li>RAM: <code>128 GB</code></li> <li>OS: <code>Ubuntu 24.04 LTS</code></li> <li>Compilers: <code>GNU Fortran 13.x</code></li> <li>MPI: <code>OpenMPI 4.1.x</code></li> <li>Math library: <code>Intel MKL</code> (installed via <code>apt</code>)</li> </ul>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#prerequisites","title":"Prerequisites","text":"<p>Install required packages:</p> <pre><code>sudo apt update\nsudo apt install -y build-essential gfortran cmake git \\\n    libopenmpi-dev openmpi-bin \\\n    libfftw3-dev python3 python3-pip gawk intel-mkl\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#locating-mkl-libraries","title":"Locating MKL Libraries","text":"<p>MKL libraries are installed in <code>/lib/x86_64-linux-gnu/</code> and headers in <code>/usr/include/mkl</code>.</p> <p>Check: <pre><code>ldconfig -p | grep mkl\nls /usr/include/mkl\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#environment-setup","title":"Environment Setup","text":"<p>Add to your <code>~/.bashrc</code>: <pre><code># === Intel MKL ===\nexport MKL_LIB=/lib/x86_64-linux-gnu\nexport MKL_INC=/usr/include/mkl\nexport INCLUDE=$MKL_INC\nexport LD_LIBRARY_PATH=$MKL_LIB:$LD_LIBRARY_PATH\n\n# Avoid MPI + MKL thread oversubscription\nexport MKL_INTERFACE_LAYER=LP64\nexport MKL_THREADING_LAYER=GNU\nexport OMP_NUM_THREADS=1\n\n# === CASTEP binaries ===\nexport PATH=$HOME/CASTEP/CASTEP-25.12/bin/linux_x86_64_gfortran10--mpi:$PATH\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#building-castep","title":"Building CASTEP","text":"<p>Unpack the source: <pre><code>tar -zxf CASTEP-25.12.tar.gz\ncd CASTEP-25.12\n</code></pre> Clean previous build </p> <pre><code>rm -rf obj/linux_x86_64_gfortran10--mpi\n</code></pre>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#mpi-build-with-mkl","title":"MPI build with MKL","text":"<p>First run make</p> <p>DL_MG=None</p> <p>In this setup, we were not able install dl_mg module. We have tried several times and the following error kept being thrown out during make statement.Error: <pre><code>/usr/bin/ld: /home/numsim/CASTEP/CASTEP-25.12/obj/linux_x86_64_gfortran10--mpi/build/../../../Source/Functional/multigrid_dlmg.f90:444:(.text+0x146db): undefined reference to __dl_mg_MOD_dl_mg_error_string' collect2: error: ld returned 1 exit status make[1]: *** [Makefile:220: ../castep.mpi] Error 1 rm f90wrap_stub.anc make[1]: Leaving directory '/home/numsim/CASTEP/CASTEP-25.12/obj/linux_x86_64_gfortran10--mpi/build' make: *** [make.inc:236: castep] Error 2\n</code></pre></p> <p>As a solution we have chosen the following command: <pre><code>make -j$(nproc) COMMS_ARCH=mpi DL_MG=none \\\n  MATHLIBS=mkl MATHLIBDIR=\"$MKL_LIB\" \\\n  FFT=mkl FFTLIBDIR=\"$MKL_LIB\" \\\n  EXTRA_LIBS=\"-Wl,--start-group -lmkl_intel_lp64 -lmkl_gnu_thread -lmkl_core -Wl,--end-group -lsymspg -lgomp -lpthread -lm -ldl\" \\\n  LDFLAGS=\"-L$MKL_LIB -Wl,--no-as-needed -Wl,-rpath,$MKL_LIB\" \\\n  BUILD=fast TARGETCPU=host\n</code></pre> then install: <pre><code>make COMMS_ARCH=mpi install\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#verifying-installation","title":"Verifying installation","text":"<p>Check that the binary links against MKL and spglib: <pre><code>ldd bin/linux_x86_64_gfortran10--mpi/castep.mpi | grep -E \"mkl|symspg\"\n</code></pre> Run version header check: <pre><code>mpirun -np 4 bin/linux_x86_64_gfortran10--mpi/castep.mpi --version\n</code></pre> Expected: MKL and OpenMPI are listed.</p>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#wrapper-script","title":"Wrapper Script","text":"<p>To run only commadn castep-mpi as default <pre><code>sudo bash -lc 'cat &gt; /usr/local/bin/castep-mpi &lt;&lt; \"EOF\"\n#!/bin/bash\n# Usage: castep-mpi &lt;nprocs&gt; &lt;seed&gt; [args...]\nNPROCS=\"$1\"; SEED=\"$2\"; shift 2\nmpirun -np \"$NPROCS\" --bind-to core \"$HOME/CASTEP/CASTEP-25.12/bin/linux_x86_64_gfortran10--mpi/castep.mpi\" \"$SEED\" \"$@\"\nEOF\nchmod +x /usr/local/bin/castep-mpi'\n</code></pre> Now you run jobs with: <pre><code>castep-mpi 24 si\n</code></pre></p>"},{"location":"DFT/Installation%20CASTEP%20-%20MKL/#troubleshoting","title":"Troubleshoting","text":"<p>MPI_ABORT error at start: missing pseudopotential \u2192 check SPECIES_POT block or PSPOT_DIR.</p> <p>Falls back to generic BLAS (-llapack -lblas): ensure MKL paths are set and passed to make.</p> <p>Undefined DL_MG symbols: either disable (DL_MG=none) or build DL_MG (DL_MG=compile) if available in your source</p>"},{"location":"DFT/Python%20Runner/","title":"Python Runner","text":"<p>You find our python package to run automated scans in castep using the wraper castep-mpi on ubuntu plataforms. here</p>"}]}